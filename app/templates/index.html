<!DOCTYPE html>
<html>
<head>
    <title>NetCut Web Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold mb-8 text-center bg-gradient-to-r from-red-500 to-pink-500 bg-clip-text text-transparent">
            NetCut Web Dashboard ‚úÇÔ∏è
        </h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">Status</h3>
                <div id="status" class="text-2xl font-bold">Idle</div>
            </div>
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">Active Targets</h3>
                <div id="active-count" class="text-2xl font-bold text-red-400">0</div>
            </div>
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-2">Total Hosts</h3>
                <div id="total-hosts" class="text-2xl font-bold">0</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div>
                <div class="flex gap-4 mb-4">
                    <button onclick="scanNetwork()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg font-semibold">
                        üîç Scan Network
                    </button>
                    <button onclick="restoreAll()" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded-lg font-semibold">
                        ‚úÖ Restore All
                    </button>
                </div>
            </div>
            <div id="info" class="bg-gray-800 p-4 rounded-lg text-sm">
                Interface: <span id="interface">-</span><br>
                Attacker: <span id="attacker">-</span><br>
                Gateway: <span id="gateway">-</span>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-2xl font-bold mb-6">Network Hosts</h2>
            <div id="hosts-container" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- Hosts will be populated here -->
            </div>
        </div>
    </div>

    <script>
        const ws = new WebSocket(`ws://${location.host}/ws`);
        let hosts = [];

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'scan_complete') {
                updateHosts(data.data.hosts);
            } else if (data.type === 'spoof_start' || data.type === 'spoof_stop') {
                updateStatus();
                refreshHosts();
            } else if (data.type === 'status') {
                updateDashboard(data.data);
            }
        };

        async function scanNetwork() {
            const response = await fetch('/api/scan');
            const data = await response.json();
            updateHosts(data.hosts);
        }

        async function toggleSpoof(ip) {
            const host = hosts.find(h => h.ip === ip);
            const isActive = host.active;
            
            if (isActive) {
                await fetch('/api/stop', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify([ip])
                });
            } else {
                await fetch('/api/spoof', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify([ip])
                });
            }
        }

        async function restoreAll() {
            await fetch('/api/stop');
        }

        function updateHosts(hostList) {
            hosts = hostList;
            const container = document.getElementById('hosts-container');
            container.innerHTML = '';
            
            hostList.forEach(host => {
                const div = document.createElement('div');
                div.className = `flex justify-between items-center p-4 border rounded-lg 
                    ${host.active ? 'bg-red-900/50 border-red-500' : 'bg-gray-700 hover:bg-gray-600'}`;
                div.innerHTML = `
                    <div>
                        <div class="font-mono text-lg">${host.ip}</div>
                        <div class="text-sm text-gray-400">${host.mac}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-semibold ${host.status === 'CUT' ? 'text-red-400' : 'text-green-400'}">${host.status}</div>
                        <button onclick="toggleSpoof('${host.ip}')" 
                                class="mt-1 px-4 py-1 rounded text-sm font-semibold 
                                ${host.active ? 'bg-green-600 hover:bg-green-500' : 'bg-red-600 hover:bg-red-500'}">
                            ${host.active ? 'üü¢ Restore' : 'üî¥ Cut'}
                        </button>
                    </div>
                `;
                container.appendChild(div);
            });
            
            document.getElementById('total-hosts').textContent = hostList.length;
        }

        async function updateStatus() {
            const response = await fetch('/api/status');
            const data = await response.json();
            document.getElementById('status').textContent = data.status.toUpperCase();
            document.getElementById('status').className = `text-2xl font-bold ${
                data.status === 'spoofing' ? 'text-red-400' : 
                data.status === 'scanning' ? 'text-yellow-400' : 'text-green-400'
            }`;
            document.getElementById('active-count').textContent = data.active.length;
        }

        async function updateDashboard(data) {
            document.getElementById('interface').textContent = data.interface;
            document.getElementById('attacker').textContent = data.attacker;
            document.getElementById('gateway').textContent = data.gateway;
            document.getElementById('active-count').textContent = data.active.length;
        }

        async function refreshHosts() {
            const response = await fetch('/api/status');
            const data = await response.json();
            updateHosts(data.targets);
        }

        // Initial load
        window.onload = function() {
            updateStatus();
        };
    </script>
</body>
</html>